From 80b4bcdfdc7aa836d1bafe014747b00d85bc22c5 Mon Sep 17 00:00:00 2001
From: Chancel Liu <chancel.liu@nxp.com>
Date: Wed, 22 Jun 2022 16:53:22 +0800
Subject: [PATCH 168/274] LF-6278-2: ASoC: fsl_rpmsg: Constrain rates of wm8524
 codec

wm8524 supports sample rates up to 192kHz.

Reviewed-by: Shengjiu Wang <shengjiu.wang@nxp.com>
Signed-off-by: Chancel Liu <chancel.liu@nxp.com>
---
 sound/soc/fsl/fsl_rpmsg.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/sound/soc/fsl/fsl_rpmsg.c b/sound/soc/fsl/fsl_rpmsg.c
index 061516ea4..60fa36f47 100644
--- a/sound/soc/fsl/fsl_rpmsg.c
+++ b/sound/soc/fsl/fsl_rpmsg.c
@@ -186,6 +186,7 @@ static int fsl_rpmsg_probe(struct platform_device *pdev)
 	struct device_node *np = pdev->dev.of_node;
 	struct snd_soc_dai_driver *dai_drv;
 	struct fsl_rpmsg *rpmsg;
+	const char *model_string;
 	int ret;
 
 	dai_drv = devm_kzalloc(&pdev->dev, sizeof(struct snd_soc_dai_driver), GFP_KERNEL);
@@ -214,6 +215,10 @@ static int fsl_rpmsg_probe(struct platform_device *pdev)
 			if (of_device_is_compatible(np, "fsl,imx8mm-rpmsg-audio"))
 				dai_drv->capture.formats = SNDRV_PCM_FMTBIT_S16_LE;
 		}
+		/* constrain rates of wm8524 codec */
+		of_property_read_string(np, "model", &model_string);
+		if (!strcmp("wm8524-audio", model_string))
+			dai_drv->playback.rates = SNDRV_PCM_RATE_8000_192000;
 	}
 	if (of_property_read_bool(np, "fsl,enable-lpa")) {
 		rpmsg->enable_lpa = 1;
-- 
2.25.1

